# Savitri Shipping - Project Rules & Context

## Project Overview
Boat rental platform (speed boats & party boats) for Indian market.

**Tech Stack:**
- Backend: Node.js + Express + MongoDB (Mongoose)
- Public Site: Next.js 14 (React)
- Admin Panel: React (Vite)

## Current Phase: Phase 1 Implementation
**Status:** Plan approved, ready to execute
**Plan Location:** `C:\Users\Sasi\.claude\plans\effervescent-kindling-reef.md`
**Memory Location:** `C:\Users\Sasi\.claude\projects\f--Code-Savitri-Shipping\memory\memory.md`

## ğŸ¯ Primary Goals (Phase 1)
1. **Remove complexity** - Delete all Phase 2 features (speed boats, bookings, vehicles)
2. **Complete auth** - Finish admin password reset, simplify customer profile
3. **Fix security** - PrivateRoute not protecting admin routes (CRITICAL)
4. **Simplify backend** - 2 roles (not 6), 2 OTP types (not 6), remove tracking
5. **Production ready** - Secure, maintainable, hostable

## ğŸš¨ Critical Security Issue
**File:** `savitri-admin/src/routes/PrivateRoute.jsx`
**Issue:** Lines 16-18 commented out - admin routes NOT protected
**Fix:** Uncomment the if statement (highest priority)

## ğŸ“ Code Patterns & Standards

### Backend
- Use Mongoose models (not Prisma)
- Service layer pattern: routes â†’ controllers â†’ services
- Error handling: try/catch with ApiError class
- Validation: Zod schemas in validators
- OTP: 6 digits, 10min expiry, 5 max attempts

### Frontend (Public - Next.js)
- App Router (not Pages Router)
- Server components by default, 'use client' when needed
- Zustand for state management
- CSS modules for styling

### Frontend (Admin - React)
- React Router v6
- Zustand for state management
- Custom hooks: useAuth, useUIStore
- Common components: Button, Input, Modal, Table

## ğŸ—‚ï¸ Directory Structure

### Backend (`savitri-backend/`)
```
src/
â”œâ”€â”€ models/          # Mongoose schemas (keep 7, delete 6)
â”œâ”€â”€ modules/         # Feature modules (delete 6 Phase 2 modules)
â”œâ”€â”€ middleware/      # auth.js, adminAuth.js, roleCheck.js
â”œâ”€â”€ config/          # constants.js (NEEDS CLEANUP)
â””â”€â”€ utils/           # email.js, otp.js, validators.js
```

### Public Site (`savitri-public/`)
```
src/app/
â”œâ”€â”€ (auth)/          # Login, register, verify pages
â””â”€â”€ account/         # Customer pages (SIMPLIFY TO 1 PAGE)
    â””â”€â”€ profile/     # Keep this only
```

### Admin Panel (`savitri-admin/`)
```
src/
â”œâ”€â”€ pages/auth/      # Login, VerifyOTP, ForgotPassword (stub), ResetPassword (stub)
â”œâ”€â”€ routes/          # PrivateRoute.jsx (SECURITY ISSUE)
â””â”€â”€ hooks/useAuth.js
```

## ğŸ”§ Implementation Guidelines

### What to DELETE (Phase 2 Features):
**Models:** SpeedBoat, SpeedBoatBooking, Counter, SavedVehicle, ActivityLog, LoginHistory
**Modules:** speedBoats, speedBoatsAdmin, speedBoatBookings, speedBoatBookingsAdmin, savedVehicles, upload
**Pages:** 8 customer pages (keep only profile)
**Constants:** VEHICLE_TYPE, GST, ACTIVITY_ACTIONS, OPERATING_HOURS, CANCELLATION_POLICY

### What to SIMPLIFY:
**Roles:** 6 â†’ 2 (Admin, Staff)
**OTP Types:** 6 â†’ 2 (EMAIL_VERIFICATION, PASSWORD_RESET)
**Customer Pages:** 10 â†’ 1 (Profile only)
**RoleCheck:** Complex permissions â†’ Simple role checking

### What to COMPLETE:
**Admin Password Reset:** Implement ForgotPassword.jsx and ResetPassword.jsx (currently stubs)
**Customer Profile:** Simplify to all-in-one page (name, password, notifications, logout)

## ğŸŒ Environment

**Database:** MongoDB Atlas (connection string in backend .env)
**Email:** Gmail SMTP (configured)
**SMS:** Master OTP "123456" (real SMS not configured)
**Default Admin:** admin@savitrishipping.in / Admin@123

## ğŸ“‹ Phase 1 Checklist
- [ ] Phase 1A: Fix PrivateRoute security (30 min)
- [ ] Phase 1B: Delete Phase 2 features (2-3 hours)
- [ ] Phase 1C: Complete auth features (4-5 hours)
- [ ] Phase 1D: Simplify backend (2-3 hours)
- [ ] Verification testing (1-2 hours)

**Estimated Total:** 10-14 hours

## ğŸ‘¤ User Context
- Not a developer but can understand code
- Wants simple, maintainable codebase
- Focus on Phase 1 only (auth, registration)
- Production-ready and secure

## ğŸš€ Quick Start for New Chat

To continue this project in a new chat:
1. Read `memory.md` for full context
2. Read approved plan at `C:\Users\Sasi\.claude\plans\effervescent-kindling-reef.md`
3. Start with Phase 1A (PrivateRoute fix)
4. Follow phases sequentially

## ğŸ“ Important Commands

**Backend:**
```bash
cd savitri-backend
npm start                 # Start server
npm run seed             # Seed database (will create 2 roles after update)
```

**Public Site:**
```bash
cd savitri-public
npm run dev              # Development server
npm run build            # Production build
```

**Admin Panel:**
```bash
cd savitri-admin
npm run dev              # Development server (Vite)
npm run build            # Production build
```

## ğŸ”— Key Files to Remember

**Security Fix:** `savitri-admin/src/routes/PrivateRoute.jsx`
**Constants Cleanup:** `savitri-backend/src/config/constants.js`
**Seed Simplification:** `savitri-backend/scripts/seed.js`
**Auth Stubs:** `savitri-admin/src/pages/auth/ForgotPassword.jsx` & `ResetPassword.jsx`

---

**Last Updated:** February 6, 2026
**Status:** Plan approved, implementation pending
**Next Step:** Execute Phase 1A (PrivateRoute security fix)